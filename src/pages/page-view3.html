<!--test manage firebase-->
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../layout/shared-styles.html">
<link rel="import" href="../common-behavior.html">

<dom-module id="page-view3">
  <template>
    <style include="shared-styles">
       :host {
        display: block;

        padding: 10px;
      }
    </style>

    <div class="card">
      <button on-click="_testLink">go to view 2</button>
      <hr>
      <input type="text" value="{{form.lat::input}}" placeholder="lat"><br>
      <input type="text" value="{{form.long::input}}" placeholder="long"><br>
      <input type="text" value="{{form.title::input}}" placeholder="title"><br>
      <input type="text" value="{{form.msg::input}}" placeholder="msg"><br>
      <button on-click="addSpot">send</button>
    </div>

    <button on-click="login">login</button>

  </template>

  <script>
    class PageView3 extends Polymer.mixinBehaviors([CommonBehavior], Polymer.Element) {
      static get is() { return 'page-view3'; }
      static get properties() {
        return {
          form: {
            type: Object,
            value: {}
          }
        }
      }
      _testLink() {
        this.changePath({ path: '/view2' })
      }

      addSpot() {
        var newPostKey = firebase.database().ref().child('coordinates').push().key;
        var updates = {};
        //updates['/coordinates/' + newPostKey] = Object.assign({},this.form,{uid:this.user.uid});
        var dateNow = Date.now();
        updates['/coordinates/' + newPostKey] = Object.assign({},this.form,{
          uid:'ccFvzfJCwEYh6JcLj63CtO5SKgf1',
          timestamp:dateNow,
          timestampInv:0-dateNow
        });
        
        return firebase.database().ref().update(updates);
      }

      login() {
        var provider = new firebase.auth.FacebookAuthProvider();
        firebase.auth().signInWithPopup(provider).then( (result)=> {
          // var token = result.credential.accessToken;
          // var user = result.user;
          this.user = result.user
          console.log(result)
        }).catch(function (error) {
          // var errorCode = error.code;
          // var errorMessage = error.message;
          // var email = error.email;
          // var credential = error.credential;
          console.log(error)
        });
      }


    }

    window.customElements.define(PageView3.is, PageView3);
  </script>
</dom-module>